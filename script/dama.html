<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Jogo de Damas - Sofia & Marcos</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { background: #eaeaea; display: flex; flex-direction: column; align-items: center; font-family: sans-serif; }
    h1 { margin-top: 20px; font-size: 2em; }
    #board { display: grid; grid-template: repeat(8, 50px) / repeat(8, 50px); border: 4px solid #444; margin-top: 20px; }
    .cell { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; }
    .dark { background: #775943; }
    .light { background: #ffe8cc; }
    .piece { border-radius: 50%; width: 40px; height: 40px; box-shadow: 0 1px 5px #4442; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .black { background: #222; }
    .white { background: #fafaff; border: 2px solid #aaa; }
    .selected { outline: 3px solid #f9c846; }
    .move { background: #a9eec2; opacity: 0.5; }
    #status { margin-top: 16px; font-size: 1.2em; }
    .coroa { font-size: 1.4em; color: #FFD700; }
    @media (max-width: 500px) {
      #board { grid-template: repeat(8, 32px) / repeat(8, 32px);}
      .cell { width: 32px; height: 32px;}
      .piece { width: 25px; height: 25px;}
    }
  </style>
</head>
<body>
  <h1>Jogo de Damas ðŸ–¤ Sofia & Marcos</h1>
  <div id="board"></div>
  <div id="status"></div>
  <script>
    // Tabuleiro e peÃ§as: 0 = vazio, 1 = preta, 2 = branca, 3 = dama preta, 4 = dama branca
    let board = [];
    let selected = null, moves = [];
    let turn = 1; // 1 = preta (Marcos), 2 = branca (Sofia)
    let gameOver = false;

    function iniciarTabuleiro() {
      board = [];
      for (let r = 0; r < 8; r++) {
        let row = [];
        for (let c = 0; c < 8; c++) {
          if ((r + c) % 2 == 1) {
            if (r < 3) row.push(2);
            else if (r > 4) row.push(1);
            else row.push(0);
          } else row.push(0);
        }
        board.push(row);
      }
      selected = null;
      moves = [];
      turn = 1;
      gameOver = false;
      render();
      atualizarStatus();
    }

    function render() {
      const el = document.getElementById("board");
      el.innerHTML = "";
      for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
          const div = document.createElement("div");
          div.className = "cell " + ((r + c) % 2 ? "dark" : "light");
          div.dataset.r = r;
          div.dataset.c = c;
          if ((r + c) % 2 == 1) {
            if (board[r][c]) {
              let piece = document.createElement("div");
              piece.className = "piece " + (board[r][c] % 2 == 1 ? "black" : "white");
              if (board[r][c] > 2) piece.innerHTML = '<span class="coroa">â™•</span>';
              if (selected && selected[0] == r && selected[1] == c) piece.classList.add("selected");
              if (turn == 1 && board[r][c] % 2 == 1) piece.onclick = () => selecionar(r, c);
              div.appendChild(piece);
            }
            if (moves.some(m => m[0] == r && m[1] == c)) div.classList.add("move");
            div.onclick = () => moverOuSelecionar(r, c);
          }
          el.appendChild(div);
        }
      }
    }

    function atualizarStatus() {
      const st = document.getElementById("status");
      if (gameOver) {
        if (gameOver == 1) st.innerHTML = "ParabÃ©ns, Marcos! VocÃª venceu! ðŸŒŸ";
        else if (gameOver == 2) st.innerHTML = "Sofia venceu desta vez! ðŸ˜˜";
        else st.innerHTML = "Empate!";
      } else {
        st.innerHTML = (turn == 1 ? "Sua vez, Marcos (pretas)" : "Vez da Sofia (brancas)");
      }
    }

    function selecionar(r, c) {
      if (turn !== 1 || board[r][c] % 2 !== 1) return;
      selected = [r, c];
      moves = movimentosPossiveis(r, c);
      render();
    }

    function moverOuSelecionar(r, c) {
      if (!selected || !moves.some(m => m[0] == r && m[1] == c)) return;
      mover(selected[0], selected[1], r, c);
      selected = null; moves = [];
      render();
      verificarFim();
      if (!gameOver && turn == 2) setTimeout(jogadaSofia, 700);
    }

    function movimentosPossiveis(r, c) {
      const piece = board[r][c];
      let dirs = [], capturas = [];
      if (piece == 1) dirs = [[-1, -1], [-1, 1]];
      if (piece == 3) dirs = [[-1, -1], [-1, 1], [1, -1], [1, 1]];
      // Captura obrigatÃ³ria:
      dirs.forEach(([dr, dc]) => {
        let nr = r + dr, nc = c + dc;
        let nr2 = r + dr * 2, nc2 = c + dc * 2;
        if (nr2 >= 0 && nr2 < 8 && nc2 >= 0 && nc2 < 8
            && board[nr][nc] % 2 == 0 && board[nr][nc] != 0 && board[nr2][nc2] == 0)
          capturas.push([nr2, nc2, nr, nc]);
      });
      if (capturas.length) return capturas.map(m => [m[0], m[1], m[2], m[3]]);
      // Movimentos simples
      let moves = [];
      dirs.forEach(([dr, dc]) => {
        let nr = r + dr, nc = c + dc;
        if (nr >= 0 && nr < 8 && nc >= 0 && nc < 8 && board[nr][nc] == 0)
          moves.push([nr, nc]);
      });
      return moves;
    }

    function mover(r1, c1, r2, c2, rCapt = null, cCapt = null) {
      let piece = board[r1][c1];
      board[r1][c1] = 0;
      board[r2][c2] = piece;
      // Virar dama
      if (piece == 1 && r2 == 0) board[r2][c2] = 3;
      if (piece == 2 && r2 == 7) board[r2][c2] = 4;
      // Captura
      if (Math.abs(r2 - r1) == 2) {
        let rMid = (r1 + r2) / 2, cMid = (c1 + c2) / 2;
        board[rMid][cMid] = 0;
      }
      turn = 3 - turn;
      render();
      atualizarStatus();
    }

    function jogadaSofia() {
      // Simples IA: pega o primeiro movimento disponÃ­vel das brancas
      let movs = [];
      for (let r = 0; r < 8; r++) for (let c = 0; c < 8; c++)
        if (board[r][c] % 2 == 0 && board[r][c] != 0) {
          let ms = movimentosPossiveisSofia(r, c);
          ms.forEach(m => movs.push([r, c, ...m]));
        }
      if (!movs.length) { gameOver = 1; atualizarStatus(); return; }
      let escolha = movs[Math.floor(Math.random() * movs.length)];
      mover(escolha[0], escolha[1], escolha[2], escolha[3]);
      verificarFim();
    }

    function movimentosPossiveisSofia(r, c) {
      const piece = board[r][c];
      let dirs = [], capturas = [];
      if (piece == 2) dirs = [[1, -1], [1, 1]];
      if (piece == 4) dirs = [[-1, -1], [-1, 1], [1, -1], [1, 1]];
      dirs.forEach(([dr, dc]) => {
        let nr = r + dr, nc = c + dc;
        let nr2 = r + dr * 2, nc2 = c + dc * 2;
        if (nr2 >= 0 && nr2 < 8 && nc2 >= 0 && nc2 < 8
            && board[nr][nc] % 2 == 1 && board[nr][nc] != 0 && board[nr2][nc2] == 0)
          capturas.push([nr2, nc2, nr, nc]);
      });
      if (capturas.length) return capturas.map(m => [m[0], m[1], m[2], m[3]]);
      // Movimentos simples
      let moves = [];
      dirs.forEach(([dr, dc]) => {
        let nr = r + dr, nc = c + dc;
        if (nr >= 0 && nr < 8 && nc >= 0 && nc < 8 && board[nr][nc] == 0)
          moves.push([nr, nc]);
      });
      return moves;
    }

    function verificarFim() {
      let pretas = 0, brancas = 0;
      for (let r = 0; r < 8; r++) for (let c = 0; c < 8; c++) {
        if (board[r][c] % 2 == 1) pretas++;
        if (board[r][c] % 2 == 0 && board[r][c] != 0) brancas++;
      }
      if (!pretas) { gameOver = 2; atualizarStatus(); }
      else if (!brancas) { gameOver = 1; atualizarStatus(); }
    }

    iniciarTabuleiro();
  </script>
</body>
</html>
