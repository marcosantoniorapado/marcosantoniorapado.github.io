<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Gravador Transcritor - Solu√ß√µes em Tecnologia</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="../assets/css/style.css" rel="stylesheet" type="text/css">
    <link href="../assets/images/favicon.png" rel="shortcut icon" type="image/x-icon">
    <link href="../assets/images/apple-touch-icon.png" rel="apple-touch-icon">
    
    <style>
        .whatsapp-float {
            position: fixed; width: 55px; height: 55px; bottom: 10px; left: 20px;
            background-color: #424242; border-radius: 50%; box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            z-index: 1000; display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s ease; text-decoration: none;
        }
        .whatsapp-float:hover { transform: scale(1.1); }

        /* Estilos para a ferramenta de gravador */
        .tool-container {
            max-width: 700px; margin: 40px auto; padding: 30px; border: 1px solid #444;
            border-radius: 8px; background-color: #2f2f2f;
            text-align: center;
        }
        .tool-container .button-group { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; justify-content: center; }
        .tool-container .button { display: inline-block; cursor: pointer; }
        
        #status {
            margin-top: 20px; background: #3b3b3b; padding: 12px; border-radius: 5px;
            font-size: 16px; color: #0f0; border: 1px solid #555;
        }

        #transcription-output { margin-top: 30px; display: none; text-align: left; }
        #transcription-text {
            background-color: #3b3b3b; padding: 15px; border-radius: 5px; white-space: pre-wrap;
            word-wrap: break-word; color: #f1f1f1; border: 1px solid #555; min-height: 150px;
        }

        /* Estilos para a se√ß√£o de configura√ß√£o */
        .config-container {
            max-width: 700px; margin: 20px auto; padding: 20px; border: 1px solid #444;
            border-radius: 8px; background-color: #2f2f2f; text-align: left;
        }
        .config-container h2 {
            margin-top: 0; display: inline-block; color: #f1f1f1;
        }
        .config-toggle {
            cursor: pointer; float: right; font-size: 24px; color: #f1f1f1;
        }
        #configBody {
            display: none; margin-top: 20px;
        }
        .config-item {
            margin-bottom: 15px; color: #f1f1f1;
        }
        .config-item label { display: block; margin-bottom: 5px; }
        .config-item input[type="password"], .config-item input[type="number"] {
            width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #555;
            background-color: #3b3b3b; color: #f1f1f1; box-sizing: border-box;
        }
        .config-item input[type="checkbox"] { margin-right: 10px; }
    </style>
</head>
<body>
    <a href="https://wa.me/5518997738569" class="whatsapp-float" target="_blank" rel="noopener noreferrer" title="Fale conosco pelo WhatsApp">
        <img src="https://img.icons8.com/ios-filled/32/ffffff/whatsapp--v1.png" alt="√çcone do WhatsApp"/>
    </a>
    <div data-animation="default" class="navbar w-nav" data-easing2="ease-in-quart" data-easing="ease-out-quart" data-collapse="medium" role="banner" data-duration="400">
        <div class="navbar-container">
            <a href="../index.html#home" class="brand w-nav-brand"><h3 class="logo-text">Solu√ß√µes em Tecnologia</h3></a>
            <nav role="navigation" class="nav-menu w-nav-menu">
                <a href="../index.html#servicos" class="nav-link w-inline-block"><div>Servi√ßos</div></a>
                <a href="../index.html#projetos" class="nav-link w-inline-block"><div>Projetos</div></a>
                <a href="../index.html#ferramentas" class="nav-link w-inline-block"><div>Ferramentas</div></a>
                <a href="../index.html#downloads" class="nav-link w-inline-block"><div>Downloads</div></a>
                <a href="../index.html#links-rapidos" class="nav-link w-inline-block"><div>Links</div></a>
                <a href="../index.html#contatos" class="nav-link w-inline-block"><div>Contatos</div></a>
                <a href="../index.html#home" class="nav-link login-link w-inline-block" aria-label="√Årea restrita">
                    <div class="login-link__content">
                        <svg class="login-link__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <span>Login</span>
                    </div>
                </a>
            </nav>
            <div class="burger-wrapper w-nav-button"><div class="burger-line top"></div><div class="burger-line"></div></div>
        </div>
        <div class="w-nav-overlay" data-wf-ignore="" id="w-nav-overlay-0"></div>
    </div>

    <div class="scroll-wrapper">
        <div class="section wf-section">
            <div class="wrapper">
                <div class="block">
                    <div class="center-items">
                        <div class="heading-jumbo small">Gravador Transcritor</div>
                        <p class="paragraph-big">Grave um √°udio, envie um arquivo e obtenha a transcri√ß√£o instantaneamente.</p>
                    </div>
                </div>
                <div class="block">
                    <div class="tool-container">
                        <div class="button-group">
                            <button type="button" id="btnGravar" class="button">Gravar √Åudio</button>
                            <button type="button" id="btnEnviarGravado" class="button">Enviar √Åudio Gravado</button>
                            <button type="button" id="btnEnviarArquivo" class="button">Enviar Arquivo de √Åudio</button>
                            <button type="button" id="btnVerTranscricao" class="button">Ver √öltima Transcri√ß√£o</button>
                            <button type="button" id="btnVerHistorico" class="button">Ver Hist√≥rico</button>
                        </div>
                        <input type="file" id="fileInput" accept="audio/*" style="display: none;">
                        <div id="status">Pronto</div>
                        
                        <div id="transcription-output">
                            <h3>Transcri√ß√£o:</h3>
                            <pre id="transcription-text">Aguardando grava√ß√£o...</pre>
                        </div>
                    </div>
                    
                    <div class="config-container">
                        <h2>Configura√ß√£o</h2>
                        <span class="config-toggle" onclick="toggleConfig()">‚ñº</span>
                        <div id="configBody">
                            <div class="config-item">
                                <label for="apiKeyInput" id="apiLabel">API Key (OpenAI):</label>
                                <input type="password" id="apiKeyInput" placeholder="Digite sua API Key">
                            </div>
                            <div class="config-item">
                                <button type="button" id="btnApiKey" class="button">Salvar API</button>
                            </div>
                            <div class="config-item">
                                <input type="checkbox" id="pararAutoCheckbox">
                                <label for="pararAutoCheckbox">Parar grava√ß√£o automaticamente</label>
                            </div>
                            <div class="config-item">
                                <label for="tempoParadaInput">Tempo para parada autom√°tica (segundos):</label>
                                <input type="number" id="tempoParadaInput" placeholder="Ex: 60" min="1">
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="section footer wf-section">
            <div class="wrapper">
                <div class="block flex vertical">
                    <a href="../index.html#home" class="brand footer-brand w-nav-brand"><h3 class="logo-text inverse">Marcos Antonio Rapado</h3></a>
                    <div class="footer-links">
                        <a href="../index.html#servicos" class="footer-link w-inline-block"><div>Servi√ßos</div></a>
                        <a href="../index.html#projetos" class="footer-link w-inline-block"><div>Projetos</div></a>
                        <a href="../index.html#ferramentas" class="footer-link w-inline-block"><div>Ferramentas</div></a>
                        <a href="../index.html#downloads" class="footer-link w-inline-block"><div>Downloads</div></a>
                        <a href="../index.html#links-rapidos" class="footer-link w-inline-block"><div>Links R√°pidos</div></a>
                        <a href="../index.html#contatos" class="footer-link w-inline-block"><div>Contatos</div></a>
                    </div>
                </div>
                <div class="block flex vertical"><div class="half-block flex center"><p class="paragraph-xsmall">¬© Copyright 2025 Marcos Antonio Rapado</p></div></div>
            </div>
        </div>
        <div class="gradient"></div>
    </div>

    <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://assets.website-files.com/6380bb0f2d13f94f9151c0cd/js/webflow.2d22f6e99.js" type="text/javascript"></script>
    <script src="https://unpkg.com/split-type"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="../assets/js/script.js" type="text/javascript"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let mediaRecorder;
            let audioChunks = [];
            let ultimaTranscricao = "";
            let historicoTranscricoes = [];
            let toggle = false;
            let intervaloStatus;
            let paradaTimeout;

            // Elementos da p√°gina
            const btnGravar = document.getElementById('btnGravar');
            const btnEnviarGravado = document.getElementById('btnEnviarGravado');
            const btnEnviarArquivo = document.getElementById('btnEnviarArquivo');
            const btnVerTranscricao = document.getElementById('btnVerTranscricao');
            const btnVerHistorico = document.getElementById('btnVerHistorico');
            const fileInput = document.getElementById('fileInput');
            const btnApiKey = document.getElementById('btnApiKey');
            const apiKeyInput = document.getElementById('apiKeyInput');
            const transcriptionOutput = document.getElementById('transcription-output');
            const transcriptionText = document.getElementById('transcription-text');

            // Carregar dados salvos ao iniciar
            window.onload = () => {
                const apiKey = localStorage.getItem("openai_api_key");
                if (apiKey) {
                    apiKeyInput.placeholder = "API Key salva";
                    btnApiKey.textContent = "Apagar API";
                }

                const historicoSalvo = localStorage.getItem("historico_transcricoes");
                if (historicoSalvo) {
                    historicoTranscricoes = JSON.parse(historicoSalvo);
                }
            };

            function mostrarStatus(msg, erro = false) {
                const el = document.getElementById("status");
                el.textContent = msg;
                el.style.color = erro ? "#f55" : "#0f0";

                setTimeout(() => {
                    el.textContent = "Pronto";
                    el.style.color = "#0f0";
                }, 15000);
            }

            window.toggleConfig = function() {
                const configBody = document.getElementById("configBody");
                configBody.style.display = configBody.style.display === "none" ? "block" : "none";
            }

            function alternarApiKey() {
                const apiKey = localStorage.getItem("openai_api_key");
                if (apiKey) {
                    localStorage.removeItem("openai_api_key");
                    btnApiKey.textContent = "Salvar API";
                    apiKeyInput.value = "";
                    apiKeyInput.placeholder = "Digite sua API Key";
                    mostrarStatus("API Key removida.");
                } else {
                    const novaKey = apiKeyInput.value;
                    if (!novaKey) {
                        mostrarStatus("Por favor, insira a API Key.", true);
                        return;
                    }
                    localStorage.setItem("openai_api_key", novaKey);
                    btnApiKey.textContent = "Apagar API";
                    apiKeyInput.value = "";
                    apiKeyInput.placeholder = "API Key salva";
                    mostrarStatus("API Key salva com sucesso!");
                }
            }

            function alternarMensagemGravacao() {
                const el = document.getElementById("status");
                intervaloStatus = setInterval(() => {
                    el.textContent = toggle ? "üéôÔ∏è Gravando..." : "üëÇ Escutando...";
                    toggle = !toggle;
                }, 1000);
            }

            function pararMensagemGravacao() {
                clearInterval(intervaloStatus);
            }

            async function gravarAudio() {
                if (!mediaRecorder || mediaRecorder.state === "inactive") {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        mediaRecorder = new MediaRecorder(stream);
                        audioChunks = [];

                        mediaRecorder.ondataavailable = event => audioChunks.push(event.data);

                        mediaRecorder.onstop = () => {
                            pararMensagemGravacao();
                            clearTimeout(paradaTimeout);
                            mostrarStatus("üî¥ Grava√ß√£o finalizada e pronta para envio");
                            btnGravar.textContent = "Gravar √Åudio";
                            stream.getTracks().forEach(track => track.stop()); // Libera o microfone
                        };

                        mediaRecorder.start();
                        btnGravar.textContent = "üî¥ Parar Grava√ß√£o";
                        alternarMensagemGravacao();

                        if (document.getElementById("pararAutoCheckbox").checked) {
                            const tempo = parseInt(document.getElementById("tempoParadaInput").value);
                            if (!isNaN(tempo) && tempo > 0) {
                                paradaTimeout = setTimeout(() => {
                                    if (mediaRecorder.state === "recording") {
                                        mediaRecorder.stop();
                                    }
                                }, tempo * 1000);
                            }
                        }

                    } catch (error) {
                        mostrarStatus("Erro ao acessar o microfone. Verifique as permiss√µes.", true);
                        console.error(error);
                    }
                } else {
                    mediaRecorder.stop();
                }
            }

            async function enviarAudioGravado() {
                if (audioChunks.length === 0) {
                    mostrarStatus("Nenhum √°udio gravado dispon√≠vel.", true);
                    return;
                }
                const blob = new Blob(audioChunks, { type: "audio/webm" });
                await transcreverAudio(blob, "audio.webm");
            }

            async function enviarAudioLocal(event) {
                const file = event.target.files[0];
                if (file) {
                    await transcreverAudio(file, file.name);
                }
            }
            
            async function transcreverAudio(audioBlob, fileName) {
                const apiKey = localStorage.getItem("openai_api_key");
                if (!apiKey) {
                    mostrarStatus("API Key n√£o encontrada. Salve sua chave primeiro na Configura√ß√£o.", true);
                    return;
                }

                const formData = new FormData();
                formData.append("file", audioBlob, fileName);
                formData.append("model", "whisper-1");

                mostrarStatus("‚è≥ Enviando √°udio para transcri√ß√£o...");

                try {
                    const response = await fetch("https://api.openai.com/v1/audio/transcriptions", {
                        method: "POST",
                        headers: {
                            Authorization: `Bearer ${apiKey}`
                        },
                        body: formData
                    });

                    const result = await response.json();
                    
                    if (response.ok && result.text) {
                        ultimaTranscricao = result.text;
                        historicoTranscricoes.push({ texto: result.text, data: new Date().toLocaleString('pt-BR') });
                        localStorage.setItem("historico_transcricoes", JSON.stringify(historicoTranscricoes));
                        mostrarStatus("‚úÖ Transcri√ß√£o conclu√≠da!");
                        
                        // Exibe a transcri√ß√£o na pr√≥pria p√°gina
                        transcriptionText.textContent = ultimaTranscricao;
                        transcriptionOutput.style.display = 'block';

                    } else {
                        const errorMsg = result.error ? result.error.message : "Erro desconhecido na transcri√ß√£o.";
                        mostrarStatus(`Erro: ${errorMsg}`, true);
                        console.error("Erro da API:", result);
                    }
                } catch (error) {
                    mostrarStatus("Erro de conex√£o ao transcrever √°udio.", true);
                    console.error("Erro no Fetch:", error);
                }
            }

            function verTranscricao() {
                if (!ultimaTranscricao) {
                    mostrarStatus("Nenhuma transcri√ß√£o recente dispon√≠vel.", true);
                    return;
                }
                transcriptionText.textContent = ultimaTranscricao;
                transcriptionOutput.style.display = 'block';
                // Rola a p√°gina at√© a transcri√ß√£o
                transcriptionOutput.scrollIntoView({ behavior: 'smooth' });
            }

            function verHistorico() {
                if (historicoTranscricoes.length === 0) {
                    mostrarStatus("Nenhuma transcri√ß√£o no hist√≥rico.", true);
                    return;
                }
                const novaAba = window.open();
                let html = `<!DOCTYPE html><html lang="pt-BR"><head><title>Hist√≥rico de Transcri√ß√µes</title><style>body{background:#222;color:white;font-family:sans-serif;padding:20px;line-height:1.6;} div{margin-bottom:25px; padding-bottom: 15px; border-bottom: 1px solid #444;} strong{color:#1e90ff;}</style></head><body><h2>Hist√≥rico de Transcri√ß√µes</h2>`;
                [...historicoTranscricoes].reverse().forEach(item => { // .reverse() para mostrar os mais recentes primeiro
                    html += `<div><strong>${item.data}</strong><p>${item.texto}</p></div>`;
                });
                html += "</body></html>";
                novaAba.document.write(html);
            }

            // Adicionando eventos aos bot√µes
            btnGravar.addEventListener('click', gravarAudio);
            btnEnviarGravado.addEventListener('click', enviarAudioGravado);
            btnEnviarArquivo.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', enviarAudioLocal);
            btnVerTranscricao.addEventListener('click', verTranscricao);
            btnVerHistorico.addEventListener('click', verHistorico);
            btnApiKey.addEventListener('click', alternarApiKey);
        });
    </script>
    <script>
        window.chtlConfig = { chatbotId: "8198551521", horizontalSpacing: 20, verticalSpacing: 30 };
    </script>
    <script async data-id="8198551521" id="chtl-script" type="text/javascript" src="https://chatling.ai/js/embed.js"></script>
</body>
</html>
